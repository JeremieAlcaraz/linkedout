{
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "messages",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          -4200,
          280
        ],
        "id": "67ed141e-4267-4b1d-9d29-7b6c4d6f8898",
        "name": "Webhook",
        "webhookId": "39c46f0c-b85d-4d63-80a9-4858850aba7d",
        "notes": "## LinkedIn Message Entry Point\nReceives messages from LinkedIn via Unipile webhook.\n\nExpects payload:\n```json\n{\n  event: 'message_received',\n  account_id: string,\n  message: string,\n  chat_id: string,\n  attendees: Array<{\n    attendee_profile_url: string,\n    attendee_provider_id: string\n  }>\n}\n```"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.POCKET_BASE_URL }}/api/collections/people/records",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Bearer {{ $('signin').item.json.token }}"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "followers",
                "value": "={{ $json.followers }}"
              },
              {
                "name": "avatar",
                "value": "={{ $json.avatar }}"
              },
              {
                "name": "lastName",
                "value": "={{ $json.lastName }}"
              },
              {
                "name": "firstName",
                "value": "={{ $json.firstName }}"
              },
              {
                "name": "linkedinUrl",
                "value": "={{ $('Webhook').item.json.body.attendees[0].attendee_profile_url }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -1920,
          320
        ],
        "id": "304533d3-b746-4c47-8508-5fec70a73f90",
        "name": "create user",
        "notes": "## Create PocketBase User\nCreates new user profile in PocketBase.\n\n⚠️ Configuration Required:\n1. Update URL to your PocketBase instance\n2. Verify collection name matches your PocketBase setup ('people')"
      },
      {
        "parameters": {
          "url": "={{ $env.POCKET_BASE_URL }}/api/collections/people/records?filter=(linkedinUrl='{{ $('Webhook').item.json.body.attendees[0].attendee_profile_url }}')",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Bearer {{ $json.token }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -2840,
          260
        ],
        "id": "0759a925-0bca-4c3b-9b3a-0bbb6bcae026",
        "name": "get user",
        "notes": "## Get User from PocketBase\nLooks up user by LinkedIn URL in PocketBase.\n\n⚠️ Configuration Required:\n1. Update URL to your PocketBase instance\n2. Verify filter syntax matches your PocketBase setup"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "6ab40ceb-8e8a-40d6-9372-566ab4a26329",
                "leftValue": "={{ $json.items }}",
                "rightValue": "",
                "operator": {
                  "type": "array",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -2660,
          260
        ],
        "id": "a15d946d-e860-4f10-8ba9-3bafade584af",
        "name": "Check User Exists",
        "notes": "## User Existence Check\nChecks if the user already exists in our database.\nRoutes to:\n- True: Update existing user\n- False: Create new user profile"
      },
      {
        "parameters": {
          "url": "=https://api.unipile.com/v1/users/",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "account_id",
                "value": "YOUR_LINKEDIN_ACCOUNT_ID"
              },
              {
                "name": "linkedin_sections",
                "value": "*"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -2340,
          320
        ],
        "id": "bfa3a42a-cd08-4fab-8642-25368365b4ff",
        "name": "get profile by id",
        "credentials": {
          "httpHeaderAuth": {
            "id": "YOUR_CREDENTIAL_ID",
            "name": "unipile"
          }
        },
        "onError": "continueRegularOutput",
        "notes": "## Fetch LinkedIn Profile\nRetrieves user profile data from Unipile API.\n\n⚠️ Configuration Required:\n1. Set up Unipile credentials\n2. Update account_id parameter to your LinkedIn account ID\n3. Configure httpHeaderAuth with your Unipile API key"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.POCKET_BASE_URL }}/api/collections/inboxes/records",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Bearer {{ $('signin').item.json.token }}"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "chatId",
                "value": "={{ $('Webhook').item.json.body.chat_id }}"
              },
              {
                "name": "message",
                "value": "={{ $('Webhook').item.json.body.message }}"
              },
              {
                "name": "messageId",
                "value": "={{ $('Webhook').item.json.body.message_id }}"
              },
              {
                "name": "timestamp",
                "value": "={{ $('Webhook').item.json.body.timestamp }}"
              },
              {
                "name": "sender",
                "value": "={{ $json.items[0].id }}"
              },
              {
                "name": "isFromMe",
                "value": "={{ $('isFromMe').item.json.isFromMe }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -2320,
          80
        ],
        "id": "f3d1630b-ceec-42c8-a287-b98c13a9f9b8",
        "name": "Store Existing User Message",
        "notes": "## Store Message (Existing User)\nSaves message to PocketBase for existing user.\n\n⚠️ Configuration Required:\n1. Update URL to your PocketBase instance\n2. Verify 'inboxes' collection exists"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.POCKET_BASE_URL }}/api/collections/inboxes/records",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Bearer {{ $('signin').item.json.token }}"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "chatId",
                "value": "={{ $('Webhook').item.json.body.chat_id }}"
              },
              {
                "name": "message",
                "value": "={{ $('Webhook').item.json.body.message }}"
              },
              {
                "name": "messageId",
                "value": "={{ $('Webhook').item.json.body.message_id }}"
              },
              {
                "name": "timestamp",
                "value": "={{ $('Webhook').item.json.body.timestamp }}"
              },
              {
                "name": "sender",
                "value": "={{ $('Store New User Message').item.json.id }}"
              },
              {
                "name": "isFromMe",
                "value": "={{ $('isFromMe').item.json.isFromMe }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -1720,
          320
        ],
        "id": "918000f8-232b-4cc9-83df-74212b6e7b79",
        "name": "Store New User Message",
        "notes": "## Store Message (New User)\nSaves message to PocketBase for new user.\n\n⚠️ Configuration Required:\n1. Update URL to your PocketBase instance\n2. Verify 'inboxes' collection exists"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "363de654-f3fe-4025-a82f-00881fe8bcbf",
                "name": "followers",
                "value": "={{ $json.follower_count }}",
                "type": "number"
              },
              {
                "id": "032ad043-5558-4787-aaef-918c6ddd38b5",
                "name": "lastName",
                "value": "={{ $json.last_name }}",
                "type": "string"
              },
              {
                "id": "9d0b89c6-5b2f-483e-bf39-86d2ffebb963",
                "name": "firstName",
                "value": "={{ $json.first_name }}",
                "type": "string"
              },
              {
                "id": "551372e9-a0f2-4a24-9d46-9a3e25576701",
                "name": "avatar",
                "value": "={{ $json.profile_picture_url }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -2120,
          320
        ],
        "id": "a93be02b-b8f7-4e12-b387-494df75d3025",
        "name": "set profile",
        "notes": "## Format User Profile\nFormats LinkedIn profile data for PocketBase storage.\nMaps fields:\n- follower_count → followers\n- first_name → firstName\n- last_name → lastName\n- profile_picture_url → avatar"
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "={{ $env.POCKET_BASE_URL }}/api/collections/people/records/{{ $('Check User Exists').item.json.items[0].id }}",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "={{ $('signin').item.json.token }}"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "messages",
                "value": "={{ JSON.stringify( $json.messages ) }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -1860,
          80
        ],
        "id": "96ef59b9-48bd-4757-bc72-e17d0160f2f8",
        "name": "update_user",
        "notes": "## Update User Messages\nUpdates user's message history in PocketBase.\n\n⚠️ Configuration Required:\n1. Update URL to your PocketBase instance\n2. Verify PATCH endpoint matches your setup\n3. Ensure messages field exists in people collection"
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "={{ $env.POCKET_BASE_URL }}/api/collections/people/records/{{ $('create user').item.json.id }}",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Bearer {{ $('signin').item.json.token }}"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "messages",
                "value": "=[\"{{ $json.id }}\"] "
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -1540,
          320
        ],
        "id": "47e49bcc-b726-417f-9348-d67b0db1e1e4",
        "name": "update_user1",
        "notes": "## Initialize User Messages\nSets initial message array for new user.\n\n⚠️ Configuration Required:\n1. Update URL to your PocketBase instance\n2. Verify PATCH endpoint matches your setup\n3. Ensure messages field exists in people collection"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "ec395eb7-1db8-4258-97ca-9b48b386a8cd",
                "name": "messages",
                "value": "={{ $('Check User Exists').item.json.items[0].messages.append($json.id) }}",
                "type": "array"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -2100,
          80
        ],
        "id": "01c94d34-c9e6-493a-a454-d2733083c47a",
        "name": "Edit Fields1"
      },
      {
        "parameters": {
          "inputText": "={{ $('Webhook').item.json.body.message }}",
          "categories": {
            "categories": [
              {
                "category": "love-your-content",
                "description": "Choose this category when the Text to Classify is regarding an initial outreach and consists mainly of complimenting work done on The Studio (aka n8n studio), The Studio Update, Flowgramming. Text may also refer to it as \"your videos\" or \"your content\".  Here is an example input text:\n thanks for your videos teaching us n8n .I'm new learner of n8n and happy to connect with you ,Max."
              },
              {
                "category": "collab-proposal",
                "description": "Choose this category when the Text to Classify includes an offer for collaboration. This could include exploring a potenital collaboration, partnership, interview on their show etc. Here is an example input text: \nn8n Collab with No-code PH Hi Max, I'm Crystal from No-code PH. Where can I send an email for a potential collab? We're doing a workflow automation talk (online only) on Feb 17th, hope we can work on something together."
              }
            ]
          },
          "options": {
            "fallback": "other"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.textClassifier",
        "typeVersion": 1,
        "position": [
          -1300,
          320
        ],
        "id": "0af4f9e3-fc4e-4be7-b38c-2b57cca7f2ad",
        "name": "Text Classifier",
        "alwaysOutputData": false,
        "notes": "## Message Classification\nClassifies messages using AI into categories:\n- love-your-content\n- collab-proposal\n- other\n\n⚠️ Configuration Required:\n1. Review and adjust category descriptions\n2. Add/modify categories as needed\n3. Configure fallback category"
      },
      {
        "parameters": {
          "model": "claude-3-haiku-20240307",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
        "typeVersion": 1.2,
        "position": [
          -1300,
          520
        ],
        "id": "7027c324-211b-4a8c-98e5-8fcfa52c2cef",
        "name": "Anthropic Chat Model",
        "credentials": {
          "anthropicApi": {
            "id": "YOUR_CREDENTIAL_ID",
            "name": "Anthropic API"
          }
        },
        "notes": "## AI Message Classification\nUses Claude to classify incoming messages.\n\n⚠️ Configuration Required:\n1. Set up Anthropic API credentials\n2. Optionally adjust model version\n3. Configure classification categories in Text Classifier node"
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "={{ $env.POCKET_BASE_URL }}/api/collections/inboxes/records/{{ $('Store New User Message').item.json.id }}",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Bearer {{ $('signin').item.json.token }}"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "category",
                "value": "={{ $json.categoryToAdd }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -560,
          240
        ],
        "id": "cc6282a4-6be1-4b11-8742-7e3286053148",
        "name": "Append tag",
        "notes": "## Update Message Category\nAdds classification category to message in PocketBase.\n\n⚠️ Configuration Required:\n1. Update URL to your PocketBase instance\n2. Verify PATCH endpoint matches your PocketBase setup"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "95498f49-d4dd-494b-95eb-40f2225542c6",
                "name": "categoryToAdd",
                "value": "love-your-content",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -840,
          140
        ],
        "id": "6f0cace4-cc14-4eef-b791-70abad4146fe",
        "name": "love-your-content"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "e098fe22-7e12-43cb-9786-99c3665061b1",
                "name": "categoryToAdd",
                "value": "collab-proposal",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -840,
          340
        ],
        "id": "e218ad46-77e0-46c2-8495-4e285e7aa70b",
        "name": "collab proposal"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          -840,
          560
        ],
        "id": "8649466d-2a82-446a-820a-6f33799c898a",
        "name": "No tag to add. Stop"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "689bf203-1a3e-4937-abf1-452a558978b7",
                "name": "isFromMe",
                "value": false,
                "type": "boolean"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3340,
          400
        ],
        "id": "b4c8b796-3dd5-47f1-b979-872a90bffb1c",
        "name": "NOTFromMe"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "689bf203-1a3e-4937-abf1-452a558978b7",
                "name": "isFromMe",
                "value": true,
                "type": "boolean"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3340,
          160
        ],
        "id": "e224ef7b-3e81-41eb-88ad-c57f58f2b1df",
        "name": "FromMe"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "4fa61395-4afe-4f94-9bd9-3543e5d4738b",
                "name": "isFromMe",
                "value": "={{ $json.isFromMe }}",
                "type": "boolean"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3160,
          260
        ],
        "id": "d7f20c09-3a0c-485c-a0ac-c16cb4b6045c",
        "name": "isFromMe"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "cd89bfa5-ea8b-4e5f-b0c9-3f4f12411396",
                      "leftValue": "={{ $json.body.content }}",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "notEmpty",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "SENTFROMAPP"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.body.attendees[0].attendee_profile_url }}",
                      "rightValue": "={{ $json.body.sender.attendee_profile_url }}",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "NOTFomME"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "87eb6241-c28e-4ff2-812f-9b8e9bcec7ca",
                      "leftValue": "={{ $json.body.attendees[0].attendee_profile_url }}",
                      "rightValue": "={{ $json.body.sender.attendee_profile_url }}",
                      "operator": {
                        "type": "string",
                        "operation": "notEquals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "FromME"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          -3760,
          280
        ],
        "id": "f685de9e-c287-41b7-8eb4-f05c784409b8",
        "name": "Switch",
        "notes": "## Message Direction Detection\nDetermines if message is:\n1. Sent from our app\n2. From the recipient (NOT from me)\n3. From me (my message)\n\nThis affects how we process and store the message."
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          -3540,
          -80
        ],
        "id": "1f469b9f-9155-4587-96bf-af5750bd3d6e",
        "name": "No Operation, do nothing"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.POCKET_BASE_URL }}/api/collections/users/auth-with-password",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "identity",
                "value": "={{ $env.POCKET_BASE_EMAIL }}"
              },
              {
                "name": "password",
                "value": "={{ $env.POCKET_BASE_PASSWORD }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -3000,
          260
        ],
        "id": "042082b6-7ce4-4b4c-bf30-60cd59ee5f5e",
        "name": "signin",
        "notes": "## PocketBase Authentication\nSigns into PocketBase admin account.\n\n⚠️ Configuration Required:\n1. Set environment variables:\n   - POCKET_BASE_URL\n   - POCKET_BASE_EMAIL\n   - POCKET_BASE_PASSWORD"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "9daace63-48e6-4c44-894a-92feabd4868c",
                "leftValue": "={{ $json.body.account_id }}",
                "rightValue": "=O-83KU3ZTgKT5A4puEq8HQ",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -3980,
          280
        ],
        "id": "2b88d0b8-0c34-48ee-bfb0-f3239d328d07",
        "name": "If",
        "notes": "## Account Validation\nVerifies the message is from the correct LinkedIn account.\n\n⚠️ Configuration Required:\n1. Update rightValue to your Unipile LinkedIn account_id"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          -3880,
          460
        ],
        "id": "4e9631cd-3da1-44c9-a1b1-d62c2dc75f54",
        "name": "No Operation, do nothing1"
      },
      {
        "parameters": {
          "content": "## 1. Message Entry and Authentication\n[Learn more about the Webhook node](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.webhook/)\n\nThe workflow starts with a webhook that receives LinkedIn messages. It first validates the account and determines if the message is from the user or someone else. This setup ensures we only process relevant LinkedIn messages and handle authentication properly.",
          "height": 220,
          "width": 490,
          "color": 7
        },
        "id": "8a69d821-89f7-45fb-ab5b-e81e6b58a988",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -4240,
          -80
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "## 2. User Management\n[Learn more about HTTP Request nodes](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.httprequest/)\n\nThis section handles user data in PocketBase. It checks if the sender exists in the database:\n- If they exist, updates their message history\n- If they're new, creates a profile by fetching LinkedIn data\nThis ensures we maintain clean user records and message history.",
          "height": 220,
          "width": 490,
          "color": 7
        },
        "id": "aa223060-e16a-4b59-ad3a-056c3a544745",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -3240,
          -280
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "## 3. Message Processing and Storage\n[Learn more about the Set node](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.set/)\n\nMessages are processed and stored with:\n- Message content\n- Timestamp\n- Chat ID\n- Sender information\n- isFromMe flag\nThis creates a complete message history for each conversation.",
          "height": 260,
          "width": 550,
          "color": 7
        },
        "id": "02596119-7e2b-4b7c-b3b4-b8258000a006",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2400,
          -300
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "## 4. AI Message Classification\n[Learn more about LangChain nodes](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.agent/)\n\nMessages are automatically categorized using AI into:\n- love-your-content\n- collab-proposal\n- other\nThis helps in organizing and prioritizing responses.",
          "height": 220,
          "width": 530,
          "color": 7
        },
        "id": "b536716e-f4d8-47ab-a4d0-81269303f584",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1620,
          -200
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "## 5. Tag Management\nThe workflow concludes by:\n- Adding appropriate tags based on AI classification\n- Updating the message record with the category\n- Preparing the data for frontend display\nThis enables better message organization and response handling. ",
          "height": 200,
          "width": 530,
          "color": 7
        },
        "id": "dece1d72-a92f-4594-8543-2642685e7506",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -920,
          -160
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "\nreplace: https://api.unipile.com/v1/users/\nwith your Unipile API endpoint\n\nUpdate query parameters:\n- account_id: Your LinkedIn account ID\n- linkedin_sections: \"*\" (or specific sections)",
          "height": 180,
          "width": 340,
          "color": 5
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2480,
          460
        ],
        "typeVersion": 1,
        "id": "6499a946-a17e-45bc-afe9-6ee6aed34fa1",
        "name": "Unipile Config"
      },
      {
        "parameters": {
          "content": "\nreplace all PocketBase URLs:\nhttps://your-pocketbase-instance\nwith your PocketBase instance URL\n\nRequired collections:\n- people\n- inboxes\n- users",
          "height": 220,
          "width": 520
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1940,
          500
        ],
        "typeVersion": 1,
        "id": "89e328b1-56aa-44b2-bfff-5ac01756d656",
        "name": "PocketBase Collections"
      },
      {
        "parameters": {
          "content": "\nAnthropic Configuration:\n1. Set up API key in credentials\n2. Current model: claude-3-haiku-20240307\n3. Adjust model based on needs\n\nClassification categories:\n- love-your-content\n- collab-proposal\n- other",
          "height": 240,
          "width": 400
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1400,
          60
        ],
        "typeVersion": 1,
        "id": "13ed8ebd-67cc-4fa7-a204-751d2fd9581c",
        "name": "AI Configuration"
      },
      {
        "parameters": {
          "content": "\nEnvironment Variables Required:\n\nPOCKET_BASE_EMAIL=admin@yourdomain.com\nPOCKET_BASE_PASSWORD=your-secure-password\n+ POCKET_BASE_URL=https://your-pocketbase-instance\n\nSet these in your n8n environment or credentials",
          "height": 200,
          "width": 400
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -3140,
          40
        ],
        "typeVersion": 1,
        "id": "998691eb-24dd-4d49-82a7-59986f301586",
        "name": "Environment Variables"
      }
    ],
    "connections": {
      "Webhook": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "create user": {
        "main": [
          [
            {
              "node": "Store New User Message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "get user": {
        "main": [
          [
            {
              "node": "Check User Exists",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check User Exists": {
        "main": [
          [
            {
              "node": "Store Existing User Message",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "get profile by id",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "get profile by id": {
        "main": [
          [
            {
              "node": "set profile",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Store Existing User Message": {
        "main": [
          [
            {
              "node": "Edit Fields1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Store New User Message": {
        "main": [
          [
            {
              "node": "update_user1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "set profile": {
        "main": [
          [
            {
              "node": "create user",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "update_user1": {
        "main": [
          [
            {
              "node": "Text Classifier",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields1": {
        "main": [
          [
            {
              "node": "update_user",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Text Classifier": {
        "main": [
          [
            {
              "node": "love-your-content",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "collab proposal",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "No tag to add. Stop",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Anthropic Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Text Classifier",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "love-your-content": {
        "main": [
          [
            {
              "node": "Append tag",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "collab proposal": {
        "main": [
          [
            {
              "node": "Append tag",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "NOTFromMe": {
        "main": [
          [
            {
              "node": "isFromMe",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "FromMe": {
        "main": [
          [
            {
              "node": "isFromMe",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "isFromMe": {
        "main": [
          [
            {
              "node": "signin",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "No Operation, do nothing",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "NOTFromMe",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "FromMe",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "signin": {
        "main": [
          [
            {
              "node": "get user",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "No Operation, do nothing1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "pinData": {},
    "meta": {
      "instanceId": "8306bac07189426109b85dc84bda2fe508e10d48e9008000e3c6ce251a84a04a"
    }
  }